sqrt(155)/176
1/32
install.packages("tidyverse")
knitr::opts_chunk$set(echo = TRUE)
k31 <- read.table("k31.mash.out", header=F)
k31 <- k31 %>% select(1:3)
library(tidyverse)
k31 <- read.table("k31.mash.out", header=F)
k31 <- k31 %>% select(1:3)
colnames(k31) <- c("S1","S2","dist")
head(k31)
k21 <- read.table("k21.mash.out", header=F)
k21 <- k21 %>% select(1:3)
colnames(k21) <- c("S1","S2","dist")
meta <- read.csv('Striga_GPS.csv', header=T)
head(meta)
meta$Site <- as.factor(str_replace(meta$Site, "2","") %>% str_trim())
head(meta)
nrow(site)
nrow(meta)
meta %>% filter(SampleID %in% unique(k21$S1))
unique(k21$S1)
meta <- read.csv('Striga_GPS.csv', header=T)
meta$Site <- as.factor(str_replace(meta$Site, "2","") %>% str_trim())
meta <- meta %>% filter(SampleID %in% unique(k21$S1))
meta
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
unique(k21$S1))
list5per
list5per <- c(list5per, "SH130", "SH134", "SH138", "SH139","SH146","SH124","SH117","SH113","SH111","SH104")
list5per
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5per
list5per <- c(list5per, "SH130", "SH134", "SH138", "SH139","SH146","SH124","SH117","SH113","SH111","SH104")
list5per
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5per <- cbind(list5per, "SH130", "SH134", "SH138", "SH139","SH146","SH124","SH117","SH113","SH111","SH104")
list5per
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
class(list5per)
list5per <- cbind(list5per, SH130, SH134, SH138, SH139,SH146,SH124,SH117,SH113,SH111,SH104)
list5per <- c("SH130", "SH134", "SH138", "SH139","SH146","SH124","SH117","SH113","SH111","SH104")
list5per
as.factor(list5per)
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5per <- c(list5per, as.factor("SH130", "SH134", "SH138", "SH139","SH146","SH124","SH117","SH113","SH111","SH104"))
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5per
list5perkh <- filter(meta, SampleID =="SH130" | "SH134"|"SH138"| "SH139"|"SH146"|"SH124"|"SH117"|"SH113"|"SH111"|"SH104"))
list5perkh <- filter(meta, SampleID =="SH130" | "SH134"|"SH138"| "SH139"|"SH146"|"SH124"|"SH117"|"SH113"|"SH111"|"SH104")
knitr::opts_chunk$set(echo = TRUE)
setwd('/Users/emilywork/Documents/GitHub/StrigaWGS/')
setwd('/Users/emilywork/Documents/GitHub/StrigaWGS/')
getwd()
setwd("/Users/ebellis/Documents/GitHub/StrigaWGS/")
#setwd("/Users/ebellis/Documents/GitHub/StrigaWGS/")
library(tidyverse)
k21 <- read.table("k21.mash.out", header=F)
k21 <- k21 %>% select(1:3)
colnames(k21) <- c("S1","S2","dist")
meta <- read.csv('Striga_GPS.csv', header=T)
meta$Site <- as.factor(str_replace(meta$Site, "2","") %>% str_trim())
meta <- meta %>% filter(SampleID %in% unique(k21$S1))
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5perkh <- filter(meta, SampleID =="SH130" | "SH134"|"SH138"| "SH139"|"SH146"|"SH124"|"SH117"|"SH113"|"SH111"|"SH104")
meta <- read.csv('Striga_GPS.csv', header=T)
meta$Site <- as.factor(str_replace(meta$Site, "2","") %>% str_trim())
meta <- meta %>% filter(SampleID %in% unique(k21$S1))
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5perkh <- filter(meta, SampleID =="SH130" | SampleID =="SH134"|SampleID =="SH138"| SampleID =="SH139"|SampleID =="SH146"|SampleID =="SH124"|SampleID =="SH117"|SampleID =="SH113"|SampleID =="SH111"|SampleID =="SH104")
k21 <- as.matrix(k21 %>% pivot_wider(names_from = S2, values_from = dist) %>%
column_to_rownames(var="S1")
)
k21
nrow(list5per)
list5per
list5perkh <- filter(meta, SampleID =="SH130" | SampleID =="SH134"|SampleID =="SH138"| SampleID =="SH139"|SampleID =="SH146"|SampleID =="SH124"|SampleID =="SH117"|SampleID =="SH113"|SampleID =="SH111"|SampleID =="SH104")$SampleID
list5perkh
c(list5per, list5perkh)
#setwd("/Users/ebellis/Documents/GitHub/StrigaWGS/")
library(tidyverse)
k21 <- read.table("k21.mash.out", header=F)
k21 <- k21 %>% select(1:3)
colnames(k21) <- c("S1","S2","dist")
k21 %>% filter(c(list5per, list5perkh))
k21 %>% filter(SampleID %in% c(list5per, list5perkh))
k21 %>% filter(SampleID %in% list5per)
k21[list5per,]
k21[c(list5per,list5perkh,]
k21[c(list5per,list5perkh),]
k21[c(list5per,list5perkh),]
library(tidyverse)
k21 <- k21 %>% select(1:3)
k21 <- read.table("k21.mash.out", header=F)
k21 <- k21 %>% select(1:3)
colnames(k21) <- c("S1","S2","dist")
k21[c(list5per,list5perkh),]
k21[list5per,]
k21[list5perkh,]
list5 <- c(list5per,list5perkh)
list5
k21$SampleID[list5]
k21$SampleID[list5,]
k21$SampleID %in% list5
meta[list5,]
meta[list5,]$Site
meta[list5,]$SampleID
meta <- read.csv('Striga_GPS.csv', header=T)
meta$Site <- as.factor(str_replace(meta$Site, "2","") %>% str_trim())
meta <- meta %>% filter(SampleID %in% unique(k21$S1))
list5per <- filter(meta, Site != "Kisii" & Site != "HomaBay")$SampleID
list5perkh <- filter(meta, SampleID =="SH130" | SampleID =="SH134"|SampleID =="SH138"| SampleID =="SH139"|SampleID =="SH146"|SampleID =="SH124"|SampleID =="SH117"|SampleID =="SH113"|SampleID =="SH111"|SampleID =="SH104")$SampleID
list5per
list5perkh
c(list5per,list5perkh)
meta
meta
knitr::opts_chunk$set(echo = TRUE)
library(phyloseq)
install.packages('phyloseq')
install.packages('devtools') #assuming it is not already installed
library(devtools)
install_github('andreacirilloac/updateR')
library(updateR)
updateR(admin_password = 'Admin user password')
updateR()
getwd()
pdf(file="FigS1_FAO.pdf", width=7.5, height=9)
wrap_plots(sen_p, mal_p, bf_p, gha_p, ngr_p, nig_p, cam_p, sud_p, eth_p, ken_p)
dev.off()
getwd()
getwd()
install.packages(c("cowplot", "ggdendro"))
library(ggdendro)
library(dplyr)
library(ggplot2)
library(tidyr)
library(cowplot)
getwd()
library(ggdendro)
library(dplyr)
library(ggplot2)
library(tidyr)
library(cowplot)
################  load gps points for experimental studies
meta <- read.csv('../DataFiles/SI.dat.1.30.20.csv')
meta <- subset(meta, emergence != "NA") # 27 localities
colnames(meta)[3] <- "emg"
meta$locality <- factor(meta$locality, levels = c("Bambey", "Maradi", "Mintimbougou","FarakoBa","SinthionMaleme","Samaru","AbuNaama","Kamboinse","Kobo","Yendi","Tamale","WadMedani","Galadima","Bakura","Damaturu","Jibiya","Andre","Kankia","Bida","Gombe","Gumi","Busia","Gwoza","Mokwa","Ngezima","Kazgail","Obeid"))
install.packages("sf")
library(ggdendro)
library(dplyr)
library(ggplot2)
library(tidyr)
library(cowplot)
################  load gps points for experimental studies
meta <- read.csv('../DataFiles/SI.dat.1.30.20.csv')
library(ggdendro)
library(dplyr)
library(ggplot2)
library(tidyr)
library(cowplot)
################  load gps points for experimental studies
meta <- read.csv('../DataFiles/SI.dat.1.30.20.csv')
meta <- subset(meta, emergence != "NA") # 27 localities
colnames(meta)[3] <- "emg"
sqrt(300)
library(lubridate)
library(ggplot2)
library(tidyverse)
rice <- read.csv('rice_remote_sensing - Sheet1.csv', header=T)
rice$Date <- as.Date(rice$Date, "%m-%d-%Y")
rice <- subset(rice, Date != "2019-06-13")
#rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE))
rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE, Test_MSE))
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name)) + geom_line(size=0.25) + facet_grid(Set~Model) + theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) + scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) + scale_linetype(name="Fold") + ylab("RMSE") + theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
#ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name)) + geom_line(size=0.4) + facet_grid(Set~Model) + theme_minimal() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) + scale_color_manual(values = c("grey70", "black"), name="Dataset", labels=c("Train", "Validation")) + scale_linetype(name="Fold") + ylab("RMSE") + theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.2)
library(lubridate)
library(ggplot2)
library(tidyverse)
rice <- read.csv('rice_remote_sensing - Sheet1.csv', header=T)
rice$Date <- as.Date(rice$Date, "%m-%d-%Y")
rice <- subset(rice, Date != "2019-06-13")
#rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE))
rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE, Test_MSE))
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Fold") +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
#ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name)) + geom_line(size=0.4) + facet_grid(Set~Model) + theme_minimal() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) + scale_color_manual(values = c("grey70", "black"), name="Dataset", labels=c("Train", "Validation")) + scale_linetype(name="Fold") + ylab("RMSE") + theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.2)
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Fold") +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Dataset") +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))
library(lubridate)
library(ggplot2)
library(tidyverse)
rice <- read.csv('rice_remote_sensing - Sheet1.csv', header=T)
rice$Date <- as.Date(rice$Date, "%m-%d-%Y")
rice <- subset(rice, Date != "2019-06-13")
#rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE))
rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE, Test_MSE))
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Dataset", labels=c("Test", "Train", "Validation")) +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
#ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name)) + geom_line(size=0.4) + facet_grid(Set~Model) + theme_minimal() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) + scale_color_manual(values = c("grey70", "black"), name="Dataset", labels=c("Train", "Validation")) + scale_linetype(name="Fold") + ylab("RMSE") + theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.2)
library(lubridate)
library(ggplot2)
library(tidyverse)
rice <- read.csv('rice_remote_sensing - Sheet1.csv', header=T)
rice$Date <- as.Date(rice$Date, "%m-%d-%Y")
rice <- subset(rice, Date != "2019-06-13")
#rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE))
rice.long <- rice %>% pivot_longer(c(Train_MSE, Val_MSE, Test_MSE))
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Dataset", labels=c("Test", "Train", "Validation")) +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
#ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name)) + geom_line(size=0.4) + facet_grid(Set~Model) + theme_minimal() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) + scale_color_manual(values = c("grey70", "black"), name="Dataset", labels=c("Train", "Validation")) + scale_linetype(name="Fold") + ylab("RMSE") + theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.2)
ggplot(rice.long, aes(x=Date, y=sqrt(value), col=name, lty=name)) +
geom_line(size=0.25) + facet_grid(Set~Model) +
theme_bw() + geom_hline(yintercept = sqrt(17.3)^2, col="red", lty=2) +
scale_color_manual(values = c("black","grey70", "grey50"), name="Dataset", labels=c("Test", "Train", "Validation")) +
scale_linetype(name="Dataset", labels=c("Test", "Train", "Validation")) +
ylab("RMSE") +
theme(axis.text.x = element_text(angle = 90, vjust=0.4))#+ geom_point(size=0.3)
knitr::opts_chunk$set(echo = TRUE, root.dir = '~/Documents/GitHub/XASU_rice/1_process_TIF_layers/')
library(reticulate)
use_python('/opt/anaconda2/envs/py36/bin/python')
py_config()
#conda_create("r-reticulate_rice")
use_condaenv("r-reticulate_rice")
#conda_install("r-reticulate_rice", "tensorflow")
library(reticulate)
#use_python('/opt/anaconda2/envs/py36/bin/python')
py_config()
#conda_create("r-reticulate_rice")
use_condaenv("r-reticulate_rice")
#conda_install("r-reticulate_rice", "tensorflow")
#conda_install("r-reticulate_rice", "tensorflow")
conda_list("r-reticulate_rice")
#conda_install("r-reticulate_rice", "tensorflow")
condaenv_list("r-reticulate_rice")
#conda_install("r-reticulate_rice", "tensorflow")
conda_env_list("r-reticulate_rice")
library(reticulate)
#use_python('/opt/anaconda2/envs/py36/bin/python')
py_config()
#conda_create("r-reticulate_rice")
use_condaenv("r-reticulate_rice")
#conda_install("r-reticulate_rice", "tensorflow")
conda_env_list("r-reticulate_rice")
reticulate::py_discover_config("tensorflow")
library(reticulate)
use_condaenv("r-reticulate_rice")
#use_python('/opt/anaconda2/envs/py36/bin/python')
py_config()
#conda_create("r-reticulate_rice")
library(reticulate)
use_condaenv("r-reticulate_rice")
py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
knitr::opts_chunk$set(echo = TRUE, root.dir = '~/Documents/GitHub/XASU_rice/1_process_TIF_layers/')
library(reticulate)
use_condaenv("r-reticulate_rice")
py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
library(reticulate)
use_python('/opt/anaconda2/envs/py36/bin/python')
use_condaenv("r-reticulate_rice")
reticulate::py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
library(reticulate)
#use_python('/opt/anaconda2/envs/py36/bin/python')
use_condaenv("r-reticulate_rice")
reticulate::py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
library(reticulate)
#use_python('/opt/anaconda2/envs/py36/bin/python')
use_condaenv("r-reticulate_rice")
reticulate::py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
library(reticulate)
use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python')
use_condaenv("r-reticulate_rice")
reticulate::py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
install.packages('tensorflow')
library(tensorflow)
library(reticulate)
use_condaenv("r-reticulate_rice", required=T)
library(reticulate)
use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python')
use_condaenv("r-reticulate_rice", required = T)
library(reticulate)
use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
#use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
use_condaenv("r-reticulate_rice", required = T)
repl_python
library(reticulate)
repl_python()
#use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
#use_condaenv("r-reticulate_rice", required = T)
#reticulate::py_config()
#use_python('/opt/anaconda2/envs/py36/bin/python')
#conda_create("r-reticulate_rice")
#repl_python()
use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
knitr::opts_chunk$set(echo = TRUE, root.dir = '~/Documents/GitHub/XASU_rice/1_process_TIF_layers/')
library(reticulate)
#use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
use_condaenv("py36", required = T)
reticulate::py_config() # had to change .Renviron file on my system to get python version from conda env and load packages
#repl_python()
library(reticulate)
#use_python('/Users/ebellis/Library/r-miniconda/envs/r-reticulate_rice/bin/python', required = T)
use_condaenv("r-reticulate_rice", required = T)
reticulate::py_config() # had to change .Renviron file on my system to get python version from conda env and load packages
#repl_python()
library(raster)
yld
raster("/Volumes/ABISSD/Yield.tif")
library(sf)
library(sp)
?CRS
version()
version
mod
library(raster)
library(rgdal)
library(sf)
library(stringr)
library(ggplot2)
library(RColorBrewer)
setwd('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/get_max_val.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/process_VIs.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/output_labels.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/create_daystack.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/output_images.R')
path_to <- "/Volumes/ABISSD/"
yld <- raster(paste0(path_to,'Yield.tif')) # utm, 5 cm resolution
yld.5 <- aggregate(yld, 10) # 0.5 x 0.5 m resolution
crop_extent <- readOGR(paste0(path_to,"04-11-2019/Carr_N_Without_Ditch.shp"))
yld.5d <- crop(yld.5, crop_extent)
yld.5dm <- mask(yld.5d, crop_extent) # 5616 cells; 5235 of these are non-NA
cuts2=c(10, 154,166,178,187,194,230) #  quantile(yld.5dm, c(0.1, 0.25, 0.5, 0.75, 0.9))
plot(yld.5dm, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Observed Yield")
plot(pred, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Predicted (2D-CNN)")
getwd()
pred <- raster('~/projectCNN_Aug01.tif')
plot(pred, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Predicted (2D-CNN)")
library(raster)
library(rgdal)
library(sf)
library(stringr)
library(ggplot2)
library(tidyverse)
setwd('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/get_max_val.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/process_VIs.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/output_labels.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/create_daystack.R')
source('~/Documents/GitHub/XASU_rice/1_process_TIF_layers/output_images.R')
path_to <- "/Volumes/ABISSD/"
e.train <- c(617769.6, 618159.6, 3828596, 3828776)
e.val <- c(617769.6,617964.6,3828776, 3828956)
e.test <- c(617964.6,618159.6,3828776, 3828956)
j = 6
flydays <- c("04-11-2019","05-21-2019","06-29-2019","07-11-2019","08-01-2019", "08-13-2019", "08-21-2019","08-28-2019","09-07-2019","09-13-2019")
channels <- c("CIgreen.tif","GNDVI.tif","NAVI.tif","NDVI.tif","RENDVI.tif","TGI.tif","Thermal.tif")
path_to_raster <- "/Volumes/ABISSD/"
vis.list <- str_replace(channels, '.tif', '')
daystack <- create_daystack(path_to_raster, flydays[j], channels, yld.5dm)
# mask so all have same number of NA's and number of images is same
mostnas_idx <- which.max(as.matrix(cellStats(daystack, stat='countNA')))
yld.dayna <- mask(yld.5dm, daystack[[mostnas_idx]])
daystack <- mask(daystack, daystack[[mostnas_idx]])
daystack <- stack(daystack, yld.dayna)
# split into test, validation, training sets
train <- crop(daystack, e.train)
val <- crop(daystack, e.val)
test <- crop(daystack, e.test)
# create dataframe for each set
train.df <- as.data.frame(na.omit(as.matrix(train))) # drop any rows with NA for any vegetation index
test.df <- as.data.frame(na.omit(as.matrix(test)))
val.df <- as.data.frame(na.omit(as.matrix(val)))
# fit linear model
mod <- lm(Yield ~ CIgreen + GNDVI + NAVI + NDVI + RENDVI + TGI + Thermal, data = train.df)
knitr::opts_chunk$set(echo = TRUE)
# plot predicted yield (linear)
r1_linear <- raster::predict(daystack, mod, progress = 'text')
# predict
r1_linear <- raster::predict(daystack, mod, progress = 'text')
plot(r1_linear, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Predicted (linear)")
j = 5
daystack <- create_daystack(path_to_raster, flydays[j], channels, yld.5dm)
# mask so all have same number of NA's and number of images is same
mostnas_idx <- which.max(as.matrix(cellStats(daystack, stat='countNA')))
yld.dayna <- mask(yld.5dm, daystack[[mostnas_idx]])
daystack <- mask(daystack, daystack[[mostnas_idx]])
daystack <- stack(daystack, yld.dayna)
# split into test, validation, training sets
train <- crop(daystack, e.train)
val <- crop(daystack, e.val)
test <- crop(daystack, e.test)
# create dataframe for each set
train.df <- as.data.frame(na.omit(as.matrix(train))) # drop any rows with NA for any vegetation index
test.df <- as.data.frame(na.omit(as.matrix(test)))
val.df <- as.data.frame(na.omit(as.matrix(val)))
# fit linear model
mod <- lm(Yield ~ CIgreen + GNDVI + NAVI + NDVI + RENDVI + TGI + Thermal, data = train.df)
# calculate MSE o
# predict
r1_linear <- raster::predict(daystack, mod, progress = 'text')
plot(r1_linear, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Predicted (linear)")
plot(pred, breaks = cuts2, col=brewer.pal(8, "RdYlBu"), main = "Predicted (2D-CNN)")
plot(pred, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (2D-CNN)")
plot(yld.5dm, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Observed Yield")
plot(r1_linear, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (linear)")
quantile(yld.5dm, c(0.1, 0.25, 0.5, 0.75, 0.9))
cuts2=c(10, 154,166,178,187,194,250) #  quantile(yld.5dm, c(0.1, 0.25, 0.5, 0.75, 0.9))
plot(pred, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (2D-CNN)")
plot(r1_linear, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (linear)")
plot(yld.5dm, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Observed Yield")
buac_to_tha <- function(bushels) {
return(bushels * 46 /  2204.62 * 2.47105)
}
buac_to_tha(100)
buac_to_tha(200)
buac_to_tha(240)
buac_to_tha(10)
buac_to_tha(154)
buac_to_tha(194)
buac_to_tha(75)
buac_to_tha(50)
buac_to_tha(25)
buac_to_tha(100)
quantile(cnn_diff, c(0.1, 0.25, 0.5, 0.75, 0.9))
cnn_diff <- yld.5dm - pred
lin_diff <- yld.5dm - r1_linear
quantile(cnn_diff, c(0.1, 0.25, 0.5, 0.75, 0.9))
quantile(lin_diff, c(0.1, 0.25, 0.5, 0.75, 0.9))
hist(lin_diff)
cuts4 <- c(-50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50)
plot(cnn_diff, breaks = cuts3, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
plot(cnn_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
cuts4 <- c(-150, -50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50, 150)
plot(cnn_diff, breaks = cuts4, col=brewer.pal(15, "RdYlBu"), main = "2D-CNN")
plot(cnn_diff, breaks = cuts4, col=brewer.pal(12, "RdYlBu"), main = "2D-CNN")
plot(lin_diff, breaks = cuts4, col=brewer.pal(12, "RdYlBu"), main = "2D-CNN")
cuts4 <- c(-50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50)
plot(lin_diff, breaks = cuts4, col=brewer.pal(12, "RdYlBu"), main = "2D-CNN")
plot(lin_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
plot(cnn_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
plot(lin_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
plot(lin_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "linear")
cuts4
buac_to_tha(50)
buac_to_tha(40)
buac_to_tha(30)
buac_to_tha(20)
buac_to_tha(10)
plot(cnn_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "2D-CNN")
plot(cnn_diff, breaks = cuts4, col=brewer.pal(12, "RdYlBu"), main = "2D-CNN")
cuts4
len(cuts4)
plot(lin_diff, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "linear")
buac_to_tha(40)
buac_to_tha(30)
buac_to_tha(20)
buac_to_tha(10)
plot(pred, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (2D-CNN)")
plot(r1_linear, breaks = cuts2, col=brewer.pal(6, "RdYlBu"), main = "Predicted (linear)")
buac_to_tha(194)
buac_to_tha(187)
buac_to_tha(178)
buac_to_tha(166)
buac_to_tha(154)
cnn_lin <- pred = r1_linear
cnn_lin <- pred - r1_linear
plot(cnn_lin, breaks = cuts4, col=brewer.pal(10, "RdYlBu"), main = "linear")
plot(cnn_lin, breaks = cuts3, col=brewer.pal(10, "RdYlBu"), main = "linear")
cuts3 <- c(-100, -75, -50, -25, 0, 25, 50, 75, 100)
plot(cnn_lin, breaks = cuts3, col=brewer.pal(10, "RdYlBu"), main = "linear")
plot(cnn_lin, breaks = cuts3, col=brewer.pal(8, "RdYlBu"), main = "linear")
